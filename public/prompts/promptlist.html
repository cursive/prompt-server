<!DOCTYPE html>
<html>

<head>
    <title>Prompt List</title>

    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/styles.css">

</head>

<body>
    <div class="nav">
        <a href="../prompts/promptlist.html">Prompts</a>
        <a href="../prompts/rubriclist.html">Rubrics</a>
        <a href="../essayreview/index.html">Essay</a>
    </div>
    <div class="header">
        <h1>Prompt list</h1>
        <button onclick="window.location.href=baseURL+'public/prompts/createprompt.html?';">
            New Prompt
        </button>
    </div>
    <p class="warning">Please do not delete the first item</p>
    <ul id="pageList"></ul>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.23.0/date_fns.min.js"></script> -->

    <script>
        var remoteRoot = "https://prompt-server--danielnacamuli.repl.co/";
        var localRoot = "http://localhost:3000/";
        var baseURL = window.location.hostname === 'localhost' ? localRoot : remoteRoot;
        function formatRelativeDate(date) {
            const now = new Date();
            return formatDistanceToNowStrict(date, { addSuffix: true });
        }
        // Fetch prompt data from the /promptata endpoint
        fetch(baseURL + 'api/getAllPrompts')
            .then(response => response.json())
            .then(data => {
                // Get the pageList element
                const pageList = document.getElementById('pageList');

                // Iterate over the prompt data and create links
                data.forEach(entry => {
                    const listItem = document.createElement('li');
                    const linkDiv = document.createElement('div'); // Create a div element for the link
                    linkDiv.classList.add('link'); // Add the "link" class to the div
                    const link = document.createElement('a');
                    const dateItem = document.createElement('div');
                    dateItem.classList.add('date');
                    const deleteButton = document.createElement('button'); // Create a delete button
                    deleteButton.classList.add('inline'); // Add the "link" class to the div
                    // Set the link's text and URL
                    link.textContent = entry.title;
                    link.href = `updateprompt.html?uuid=${entry.uuid}`; // Pass the uuid as a query parameter
                    dateItem.textContent = entry.date;
                    //const formattedDate = formatRelativeDate(new Date(entry.date));
                    //dateItem.textContent = formattedDate;
                    // Set the delete button's text and add an event listener
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', () => {
                        deletePrompt(entry.uuid); // Call the deletePrompt function passing the uuid
                    });

                    // Append the link to the link div
                    linkDiv.appendChild(link);

                    // Append the link div and delete button to the list item
                    listItem.appendChild(linkDiv);
                    listItem.appendChild(dateItem);
                    listItem.appendChild(deleteButton);

                    pageList.appendChild(listItem);
                });
            })
            .catch(error => console.error(error));
        function deletePrompt(uuid) {
            const confirmed = window.confirm('Are you sure you want to delete this prompt?');
            if (confirmed) {
                // Call the API's delete method using fetch
                fetch(baseURL + 'api/deleteprompt/' + uuid, {
                    method: 'DELETE'
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data); // Log the response from the API
                        location.reload();
                    })
                    .catch(error => console.error(error));
            }
        }
    </script>

</body>

</html>